// Generated by CoffeeScript 1.6.3
(function() {
  var Deferred, Whirlr,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Deferred = (typeof $ !== "undefined" && $ !== null ? $.Deferred : void 0) || (require('simply-deferred')).Deferred;

  Whirlr = (function() {
    function Whirlr() {
      this._next = __bind(this._next, this);
      this.queues = [];
      this._lock = Deferred().resolve();
    }

    Whirlr.prototype.sort = function(f) {
      return this.queues.sort(f);
    };

    Whirlr.prototype.locked = function() {
      return this._lock.state() !== 'resolved';
    };

    Whirlr.prototype.lock = function() {
      return this.prependQueue(function(d) {});
    };

    Whirlr.prototype.unlock = function() {
      return this._lock.resolve();
    };

    Whirlr.prototype._next = function() {
      var deferred_func;
      if (deferred_func = this.queues.shift()) {
        deferred_func(this._lock);
        return this._lock.done(this._next);
      } else {
        return this._lock.resolve();
      }
    };

    Whirlr.prototype._startIfReady = function() {
      var _this = this;
      if (!this.locked()) {
        this._lock = Deferred();
        return setTimeout(function() {
          return _this._next();
        }, 0);
      }
    };

    Whirlr.prototype.prependQueue = function(deferred_func) {
      this.queues.unshift(deferred_func);
      return this._startIfReady();
    };

    Whirlr.prototype.addQueue = function(deferred_func) {
      this.queues.push(deferred_func);
      return this._startIfReady();
    };

    return Whirlr;

  })();

  if ((typeof module !== "undefined" && module !== null ? module.exports : void 0) != null) {
    module.exports = Whirlr;
  } else {
    window.Whirlr = Whirlr;
  }

}).call(this);
